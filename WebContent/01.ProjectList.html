<!DOCTYPE html>
<html>
<head>
<title>Production List</title>
<link rel="stylesheet" type="text/css" href="css/jmscms.css" />
<link rel="stylesheet" type="text/css" href="js/jquery-ui.css" />

<script type="text/javascript" src="js/jquery-3.3.1.js"></script>
<script type="text/javascript" src="js/jsviews.js"></script>  
<script type="text/javascript" src="js/jquery-ui.js"></script>
<script type="text/javascript" src="js/jquery.tablesorter.js"></script>
<style>
.warning{
  color: red;
}
.focus {
  color: black;
  font-style: normal;
}
</style>
</head>
<body>
  <div id="common">
  include common.html here
  </div>
  
  <div class="right_section">
    <!-- Here is name of the list -->
    <div class="toolbar">
      <div class="tab">
        <button class="tablinks" onclick="">Project Status</button>
      </div>
    </div>
    <div class="nemubar">
      <!-- Here is position of nemu bar -->
      <ul>
      <!-- 
        <li><a class="selecttab" href="02.ProjectDetail.html?NewProject=true">New Project</a></li>
      -->
        <li><a class="selecttab" href="99.ProjectUpdate.html?NewProject=true">New Project</a></li>
        <li><a href="#Filter">Filter</a></li>
      </ul>
    </div>
    <div id="list_section">
      <!-- Here is the list -->
      <div id="projects_div"></div>
    </div>
  </div>
  
  <div id="assignToWindow" class="modalwindow" title="Assign to" style="overflow: hidden;">
    <form method="post" id="form2">
    <input id="filter" style="width: 100%; height: 20px; resize: none; color: gray; font-style: italic;" value="input filter"></input><br/><br/>
    <div style="overflow: scroll; overflow-x: hidden; height:203px; border: 1px solid #99aabd;">
    <ul>
    </ul>
    </div>
      <br/>
      <p align="center"><input class="botton999" id="submit" type="button"
          value="Save" /></p>
    </form>
  </div>
</body>

<script id="myHoursTmpl" type="text/x-jsrender">  
      <table class="list_table" id="tbl">
        <thead>
          <tr>
            <th width="8%">Client</th>
            <th width="20%">Category Criteria</th>
            <th width="10%">Start Date</th>
            <th width="10%">Last Update Date</th>
            <th width="15%">Assigned To</th>
            <th width="8%">Estimated Hours</th>
            <th width="10%">Total Worked Hours</th>
            <th width="10%">Remain Hours</th>
            <th width="8%">Progress</th>
          </tr>
        </thead>
        <tbody>
{{for p}} 
          <tr>
            <td>{{:Client}}</td>
            <td style="text-align: left;"><a href="99.ProjectUpdate.html">{{:CategoryCriteria}}</a></td>
            <td>{{:StartDate}}</td>
            <td>{{:LastUpdate}}</td>
            <td style="text-align: left;" ><a class="assigned" href="#" data-names="{{:AssignedTo}}">
{{for AssignedTo}}
            {{:#data}}<br/>
{{/for}} 
            </a></td>
            <td>{{:estimate}}</td>
            <td>{{:TotalWorkedHours}}</td>
            <td class="remaintd">{{:remain}}</td>
            <td class="progresstd">{{:progress}} %</td>
          </tr>
{{/for}} 
        </tbody> 
    </table>
</script>
<script >
var allNames = [
  "Barbara Mora",
  "Christina Potter",
  "Dawn Reynolds",
  "Donna Anderson",
  "Elizabeth Buckner",
  "Jasmine Mason",
  "Joe Castiglia",
  "Karen McWilliams",
  "Mary Beth Donalson",
  "Nancy Rikala",
  "Nicole DePaul",
  "Patty Raudenbush",
  "Peggy Goff",
  "Shelley Rice",
  "Team 3",
  "Terri Pierno",
  "Tracey Palmer",
  "Tracie Salazar",
  "Valeria Smith"
];
var selectedNames = [];

function loadProjects(){
  var myTemplate = $.templates("#myHoursTmpl");  
  $.getJSON( "json/Projects.json", function( data ) {
	  var filterDate = [];
	  $.each(data, function(index, value){
		  value['estimate'] = 200;
		  value['remain'] = 200 - value['TotalWorkedHours'];
		  value['progress'] = Math.round(value['TotalWorkedHours'] / 200 * 100);
		  filterDate.push(value);
	  });
    var app = {p: filterDate };  
    myTemplate.link("#projects_div", app);
    $(".remaintd").each(function() {
    	var t = $( this ).html();
    	if (t.startsWith("-")){
    	  $( this ).addClass( "warning" );
    	  $( this ).next().addClass( "warning" );
    	}
    });
    
    $(".assigned").on("click", function (){
      selectedNames = $(this).attr("data-names").split(',');
      $("#assignToWindow ul").empty();
      allNames.forEach(function(n){
        if ($.inArray(n, selectedNames) >= 0){
          $("#assignToWindow ul").append('<li><input type="checkbox" checked="true" value="' + n +'" />'+ n +'</li>');
        } else {
          $("#assignToWindow ul").append('<li><input type="checkbox" value="' + n +'" />'+ n +'</li>');
        }
      });
      
      $("#filter").val("input filter")
      .select()
      .css("color", "gray")
      .css("font-style", "italic");

      $( "#assignToWindow" ).dialog({
        height: 323,
        width: 200,
        modal: true,
        resizable:false,
        close: function(){
          $( "#assignToWindow" ).dialog("close");
        },
        show : {
          effect : "blind",
          duration : 500
        },
        hide : {
          effect : "blind",
          duration : 500
        }
      });
      $( "#assignToWindow #filter" ).focus();
    });
    
    $(".list_table").tablesorter();
  });
}

$(document).ready(function() {
 
  $("#common").load("00.common.html");
  
  loadProjects();
  
  $( "#filter" )
  .on( "keydown mousedown", function( event ) {
      if ( event.keyCode === $.ui.keyCode.TAB &&
          $( this ).autocomplete( "instance" ).menu.active ) {
        event.preventDefault();
      }
      if($(this).val() == "input filter"){
        $(this)
        .val("")
        .css("color", "black")
        .css("font-style", "normal");
      }
  })
  .autocomplete({
    minLength: 0,
    source: function( request, response ) {
      var fr = $.ui.autocomplete.filter(allNames, request.term);
      $("li input").each(function(i, obj){
        if ($.inArray($(obj).val(), fr) >= 0){
          $(obj).parent().show();
        } else {
          $(obj).parent().hide();
        }
      });
    }
  });
  
  $("#assignToWindow #submit").on("click", function(){
    $( "#assignToWindow" ).dialog("close");
  })
});
</script>
</html>
