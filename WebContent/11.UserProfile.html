<!DOCTYPE html>
<html>
<head>
<title>User Profile</title>
<link rel="stylesheet" type="text/css" href="css/jmscms.css" />

<script type="text/javascript" src="js/jquery-3.3.1.js"></script>
<script type="text/javascript" src="js/jsviews.js"></script>

<link rel="stylesheet" type="text/css" href="js/jquery-ui/jquery-ui.css" />
<script type="text/javascript" src="js/jquery-ui/jquery-ui.js"></script>

<script type="text/javascript" src="js/jms_cms_2018.js"></script>
</head>
<style>
#checked {
 visibility: hidden;
}
</style>
<body>
  <div id="common">
  include common.html here
  </div>
  <script>
    $("#common").load("00.common.html");
  </script>
  <div class="right_section">
  <!-- Here is name of the list -->
  <div class="toolbar">
    <div class="tab">
      <button class="tablinks" onclick="">User Profile</button>
    </div>
  </div>
  <div class="nemubar">
    <!-- Here is position of nemu bar -->
    <ul>
      <li><a href="#" id="editMenu" onclick="toEdit();">Edit</a></li>
      <li><a href="#">Delete</a></li>
    </ul>
  </div>
    <div class="detail_section">
    <form id="form1"></form>
    <div class="accordion active">
      <h3>Base Information</h3>
      <div>
        <table>
        <tr>
        <td>Login Name:</td><td><input type="text" size="100" class="editable required" id="loginid" form="form1" value="" readonly/></td>
        <td><img src="images/ok_16px.png" id="checked"></td><td></td>
        </tr>
        <tr>
        <td>First Name:</td><td><input type="text" size="100" class="editable required" id="firstname" form="form1" value="" readonly/></td><td></td><td></td>
        </tr>
        <tr>
        <td>Last Name:</td><td><input type="text" size="100" class="editable required" id="lastname" form="form1" value="" readonly/></td><td></td><td></td>
        </tr>
        <tr>
        <td>Middle Name:</td><td><input type="text" size="100" class="editable" id="midname" value="" readonly/></td><td></td><td></td>
        </tr>
        <tr>
        <td>Organization:</td><td><input type="text" size="100" class="editable required" id="unit" value="" readonly/></td><td></td><td></td>
        </tr>
        <tr>
          <td>JMS/Client/Vender:</td>
          <td>
          <select id="orgtype">
            <option value="Required" disabled selected>Required</option>
            <option value="JMS">JMS</option>
            <option value="CLIENT">CLIENT</option>
            <option value="VENDOR">VENDOR</option>
          </select></td><td>
          </td>
        </tr>
        </table>
      </div>
    </div>
    <div class="accordion active">
      <h3>Security</h3>
      <div>
        <table>
        <tr>
        <td>Password</td>
        <td>Before update your password, verify your mail address first.</td><td></td>
        <td><a href="#">Change Password</a></td>
        </tr>

        <tr>
        <td>Last Login:</td>
        <td id="lastlogin">2018-10-08 21:34:03</td><td></td>
        <td></td>
        </tr>
        </table>
      </div>
    </div>
    <div class="accordion active">
      <h3>Contact Address</h3>
      <div style="display: none", aria-hide="true">
        <table>
        <tr>
        <td>Email:</td><td><input type="text" size="100" class="editable required" id="email" value="" readonly/></td><td><a href="#" id="verifyEmail">Verified</a></td>
        </tr>
        <tr>
        <td>Phone:</td><td><input type="text" size="100" class="editable" id="phone" value="" readonly/></td><td></td>
        </tr>
        <tr>
        <td>Address:</td><td><input type="text" size="100" class="editable" id="address" value="" readonly/></td><td></td>
        </tr>
        <tr>
        <td>City:</td><td><input type="text" size="100" class="editable" id="city" value="" readonly/></td><td></td>
        </tr>
        <tr>
        <td>State:</td><td><input type="text" size="100" class="editable" id="state" value="" readonly/></td><td></td>
        </tr>
        <tr>
        <td>ZipCode:</td><td><input type="text" size="100" class="editable" id="zipcode" value="" readonly/></td><td></td>
        </tr>
        </table>
      </div>
    </div>
    <div class="accordion">
      <h3>Roles</h3>
      <div style="display: none", aria-hide="true">
        <table>
        <tr>
        <td>Administrator</td><td id="Administrator">System Administrator</td><td></td>
        </tr>
        <tr>
        <td>All_module_view</td><td id="Phone">All Module View</td><td></td>
        </tr>
        </table>
      </div>
    </div>
    <div class="accordion">
      <h3>Misc</h3>
      <div>
        <table>
        <tr>
        <td>Create Date:</td><td id="createdate">2015-06-08T21:34:03Z</td><td></td>
        </tr>
        <tr>
        <td>Deleted:</td><td id="isdel">0</td><td></td>
        </tr>
        </table>
      </div>
    </div>


  </div>
  </div>
  <script>
  var aUser =    {
      "SN" : "c3730f85-80f3-4621-a043-6164bf0ebe0c",
      "userid" : "LancerZ",
      "firstname" : "Lancer",
      "unit" : "JMS",
      "status" : "Enabled",
      "unittype" : "VENDOR",
      "lastname" : "Zhang",
      "midname" : "",
      "isdel" : "0",
      "createdate" : "2015-06-08T21:34:03Z",
      "TelNO" : "248-888-9999",
      "EMail" : "lancer@jmsassoc.com",
      "Address" : "",
      "ZipCode" : "",
      "State" : "",
      "City" : ""
  };
  
  function render(user){
    $("input[id=loginid]").prop("defaultValue", user.userid);
    $("input[id=firstname]").prop("defaultValue", user.firstname);
    $("input[id=lastname]").prop("defaultValue", user.lastname);
    $("input[id=midname]").prop("defaultValue", user.midname);
    $("input[id=unit]").prop("defaultValue", user.unit);
    $("input[id=email]").prop("defaultValue", user.EMail);
    $("input[id=phone]").prop("defaultValue", user.TelNO);
    $("input[id=address]").prop("defaultValue", user.Address);
    $("input[id=city]").prop("defaultValue", user.City);
    $("input[id=state]").prop("defaultValue", user.State);
    $("input[id=zipcode]").prop("defaultValue", user.ZipCode);
    // handle select tag
    if (!user.unittype) user.unittype = "required";
    $("#orgtype").prop("defaultValue", user.unittype);
    $("#orgtype option[value=" + user.unittype + "]").prop("selected", true);
    $( "#orgtype" ).selectmenu();
  }
  
  function toEdit(isCreate){
    if (!isCreate)  isCreate = false;
    console.log(isCreate);
    ui = $("#editMenu");
    var label = $(ui).html();
    
    if(label === "Edit"){
      $("input.editable")
            .not("#loginid")
            .addClass("enable")
            .prop("readonly", false);
      //$("select#orgtype").prop('disabled', true);
      if(isCreate){ 
        $("#loginid")
            .addClass("enable")
            .prop("readonly", false)
            .focusout(function() {
              var newLoginId = $( this ).val();
              if(newLoginId != ''){
                $.getJSON('json/true.json', {"userid":newLoginId}, function(data){
                  if(data){
                    $("#checked").css("visibility", "visible");
                  } else {
                    alert('userid [' + newLoginId + '] is not available');
                  }
                });
              }
            })
        $("#verifyEmail").html("To Verify");
      }
      $(ui).html("Save");
    } 
    if (label === "Save"){
      var changedValues = {};
      $('input').each(function(){
        var eid = $(this).prop("id");
        var value = $(this).val();
        if ($(this).prop("defaultValue") != value){
          changedValues[eid] = value;
        }
      });
      var value = $("#orgtype option:selected").val();
      if ( value != $("#orgtype").prop("defaultValue")) {
          changedValues['unittype'] = value;
      }
      $.post("json/aUser.json",
          changedValues,
          function(data){
            console.log(data);
            render(data);
            $("input.editable").removeClass("enable");
            $("input.editable").prop("readonly", true);
            $(ui).html("Edit");
      });
    }
  }
  
  $(document).ajaxError(function(event,xhr,options,exc){
    alert("An error occurred! " + [options.type, options.url, xhr.status].join(", "));
  });
  
  $( function() {
    $( ".accordion" ).accordion({
      collapsible: true, 
      active: false,
      heightStyle: "content"
      });
    $( ".active" ).accordion({
      active: 0 
      });
    
    $( "input.required" ).attr("placeholder", "Required");
    var p = getParameterByName('create');
    if (null != p){
      for(var k in aUser){
        aUser[k] = "";
      }
      toEdit( true );
    }
    render(aUser);
  });
  


  </script>
</body>
</html>
