<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Project</title>
<link rel="stylesheet" type="text/css" href="css/jmscms.css" />
<link rel="stylesheet" type="text/css" href="js/jquery-ui.css" />

<script type="text/javascript" src="js/jquery-3.3.1.js"></script>
<script type="text/javascript" src="js/jsviews.js"></script>  
<script type="text/javascript" src="js/jquery-ui.js"></script>
<script type="text/javascript" src="js/jms_cms_2018.js"></script>

</head>
<body>
  <div id="common">
  include common.html here
  </div>
  <div class="right_section">
    <!-- Here is name of the list -->
    <div class="toolbar">
      <div class="tab">
        <button id="tabName" class="selecttab" onclick="activetab(this)">Project Detail</button>
        <!-- 
        <button class="tablinks" onclick="activetab(this)">Project Comments</button>
        <button class="tablinks" onclick="activetab(this)">Project Hours</button>
         -->
      </div>
    </div>

  <div class=nemubar>
        <!-- Here is position of nemu bar -->
      <ul>
        <li><a href="#" onclick="newProject()">New Project</a></li>
        <li><a href="#" id="editProject" onclick="editSave()">Edit</a></li>
        <li><a href="#">Delete</a></li>
        <li><a href="#">Close</a></li>
        <li><a href="#" onclick="loadDetailRates()">Detail Rates</a></li>
        <li><a href="#" onclick="loadHoursDetail()">Hours Detail</a></li>
        <li><a href="#" onclick="loadComments()">Comments</a></li>
        <li><a href="#" onclick="showCommentWindow1()">New Comment</a></li>
      </ul>
  </div>

  <div class="list_section">
      <form method="post" id="form1">
        <div style="padding: 10px;">
        <table class="detail_table" style="border-collapse:separate; border-spacing:0px 10px;">
          <tr>
            <td class="td_bg01">*Name</td>
            <td class="td_bg02"><input id="name" type="text" class="tf_120 editable" value="BHS104" readonly/> </td>
            <td class="td_bg01">Client Name</td>
            <td class="td_bg02"><input id="FullName" type="text" class="tf_120 editable" value="Berends Hendricks Stuit" readonly/></td>
            <td class="td_bg01">Contract</td>
            <td class="td_bg02"><input name="PhoneNumber" type="text" class="tf_120 editable" value="Arya" readonly/></td>
          </tr>

          <tr>
            <td class="td_bg01">Start Date</td>
            <td class="td_bg02"><input name="StartDate" id="startdate"              type="text" class="tf_120 editable" value="2018.01.01" readonly/></td>
            <td class="td_bg01">End Date</td>
            <td class="td_bg02"><input name="EndDate" id="enddate"              type="text" class="tf_120 editable" value="2018.11.21" readonly/></td>
            <td class="td_bg01">Estinate Hours</td>
            <td class="td_bg02"><input name="EstinateHours"              type="text" class="tf_120 editable" value="100" readonly/></td>
          </tr>

          <tr>
            <td class="td_bg01">Assigned To</td>
            <td class="td_bg02"><input name="Assigned To"              type="text" class="tf_120 editable" value="Lancer, Winner, Daniel" readonly/></td>
            <td class="td_bg01">Submited Hours</td>
            <td class="td_bg02"><input name="SubmitedHours"              type="text" class="tf_120 editable" value="50" readonly/></td>
            <td class="td_bg01">Validated Hours</td>
            <td class="td_bg02"><input name="ValidatedHours"              type="text" class="tf_120 editable" value="45" readonly/></td>
          </tr>
        </table>
        </div>
        <div>
        <table id="detailList" class="list_table" style="border: 0px;">
        </table>
        </div>
      </form>
    </div>
  </div>

  <div id="newCommentWindow" class="modalwindow" title="Add a Comment">
      <form method="post" id="form2">
      <table>
        <tr>
        <td width="100%"><textarea  name="comment" style="width:400px; height:200px; resize:none;"></textarea></td>
        </tr>
        <tr>
          <td align="center"><input class="botton999" type="button"
            value="Save" onclick="commentWindowSave()" /></td>
        </tr>
      </table>
      </form>
  </div>
  
  <div id="newConfirmWindow" class="modalwindow" title="Confirm Hours" >
      <form method="post" id="form4">
      <table>
        <tr><td id="message">Lancer's Hours/Comments for Project BHS104 in 2018.08.20 </td></tr>
        <tr>
        <td width="100%"><input id="whours" class="tf_120" value="4" readonly/></td>
        </tr>
        <tr>
        <td width="100%"><textarea  id="wcomments" style="width:400px; height:100px; resize:none;" readonly>She told herself, light as a feather</textarea></td>
        </tr>
	      <tr><td>Please to comfirm Lancer's hours above</td></tr>
        <tr>
        <td width="100%"><input  id="hours" class="tf_120" value="4"/></td>
        </tr>
        <tr>
        <td width="100%"><textarea  id="comments" style="width:400px; height:100px; resize:none;"/></textarea></td>
        </tr>
        <tr>
          <td align="center"><input class="botton999" type="button"
            value="Confirm" onclick="comfirmWindowSave()" /></td>
        </tr>
      </table>
      </form>
  </div>

</body>

<script id="rateTmpl" type="text/x-jsrender">  
        <thead>
          <tr>
            <th width="25%">Rate Type</th>
            <th>Description</th>
            <th width="10%">Rate</th>
            <th width="10%">Estimate Hours</th>
            <th width="10%">Completed Hours</th>
          </tr>
        </thead>
        <tbody>
{{for p}} 
          <tr>
          <td style="text-align: left;">{{:#data[0]}}</td>
          <td><input width="100%" type="text" style="text-align: left;" class="tf_120 editable" value="{{:#data[2]}}" readonly/></td>
          <td><input width="100%" type="text" class="tf_120 editable" value="{{:#data[3]}}" readonly /></td>
          <td><input width="100%" type="text" class="tf_120 editable" value="{{:#data[4]}}" readonly /></td>
          <td class="recalc">{{:#data[5]}}</td>
          </tr>
{{/for}} 
        </tbody> 
</script>

<script id="commentTmpl" type="text/x-jsrender">  
        <thead>
          <tr>
            <th width="10%">Author</th>
            <th width="10%">Date</th>
            <th width="70%">Comments</th>
            <th width="10%">Operation</th>
          </tr>
        </thead>
        <tbody>
{{for p}} 
          <tr>
            <td>{{:author}}</td>
						<td>{{:date}}   </td>
            <td class="leftalign">{{:comment}} </td>
            <td><input class="botton999" id="add"
              type="button" value="delete" name="Delete" onclick="" /></td>
          </tr>
{{/for}} 
        </tbody> 
</script>

<script id="HoursTmpl" type="text/x-jsrender">  
        <thead>
          <tr>
            <th width="10%">Date</th>
            <th width="10%">Worker Name</th>
            <th width="5%">Submitted</th>
            <th width="30%">Submitted Notes</th>
            <th width="5%">Confirmed</th>
            <th width="30%">Confirmed Notes</th>
						<th width="10%">Operation</th>
          </tr>
        </thead>
        <tbody>
{{for p}} 
          <tr>
            <td>{{:date}}</td>
            <td>{{:worker}}   </td>
            <td>{{:submitted}} </td>
						<td class="leftalign">{{:workerNotes}} </td>
						<td>{{:confirmed}} </td>
						<td class="leftalign">{{:confirmedNotes}} </td>
            <td><input class="botton999" 
              type="button" value="Comfirm" name="Comfirm" onclick="showComfirmWindow(this)" /></td>
          </tr>
{{/for}} 
        </tbody> 
</script> 
 

<script type="text/javascript">
function loadDetailRates(isNew = false) {
	  var myTemplate = $.templates("#rateTmpl");  
	  $.getJSON( "json/projectRate.json", function( data ) {
		  if(isNew){
			  $.each(data, function(index, value){
				  value[2] = "";
				  value[3] = "";
				  value[4] = "";
				  value[5] = 0;
			  });
		  }
	    var app = {p: data };
	    myTemplate.link("#detailList", app);
	    });
	}

function loadComments() {
  var myTemplate = $.templates("#commentTmpl");  
  $.getJSON( "json/comments.json", function( data ) {
    var app = {p: data };  
    myTemplate.link("#detailList", app);
  	});
}

function loadHoursDetail(){
  var myTemplate = $.templates("#HoursTmpl");  
  $.getJSON( "json/hours.json", function( data ) {
    var app = {p: data };  
    myTemplate.link("#detailList", app);
  	});
}

function newProject() {
	$("#editProject").html("Edit");
	editSave();
	$(".editable").each(function(){
		this.value = "";
		$( this ).prop("readonly",false);
	});
	$(".recalc").html("0");
}

function editSave() {
	var t = $("#editProject").html();
	if (t == "Edit") {
		$("#editProject").html("Save");
		$(".editable").prop("readonly",false);
	  $("#startdate").datepicker();
	  $("#enddate").datepicker();
	}
	if (t == "Save") {
	  $(".editable").prop("readonly",true);
		// do some save proc
		$("#editProject").html("Edit");
    $("#startdate").datepicker( "destroy" );
    $("#enddate").datepicker( "destroy" );
	}
}

function showCommentWindow1(){
	$( "#newCommentWindow" ).find("textarea").val("");
	$( "#newCommentWindow" ).dialog({
	      height: 300,
	      width: 500,
	      modal: true,
	      resizable:false
	 });
}

function commentWindowSave(){
  $( "#newCommentWindow" ).dialog("close");
}

function showComfirmWindow(self){
	var kids = self.closest("tr").children;
	var workDate = $(kids[0]).html();
	var worker = $(kids[1]).html();
	var workerHours = $(kids[2]).html();
	var workerComments = $(kids[3]).html();
	var message = worker + "'s Hours/Comments for Project BHS104 in " + workDate;
	$( "#newConfirmWindow" ).find("#message").html(message);
	$( "#newConfirmWindow" ).find("#whours" ).val(workerHours);
	$( "#newConfirmWindow" ).find("#wcomments" ).val(workerComments);
	$( "#newConfirmWindow" ).find("#hours" ).val(workerHours);
	$( "#newConfirmWindow" ).find("#comments" ).val("");

	$( "#newConfirmWindow" ).dialog({
	      height: 400,
	      width: 500,
	      modal: true,
	      resizable:false
	    });
}


function comfirmWindowSave(){
	$( "#newConfirmWindow" ).dialog("close");
}

function activetab( object ){
	$( ".tab > button" ).addClass("tablinks");
	$( object ).removeClass("tablinks");
	$( object ).removeClass("selecttab");
}

$(document).ready(function() {
	  $("#common").load("00.common.html");
	  var isNewProject = getParameterByName('NewProject') != null;
	  console.log(isNewProject);
	  loadDetailRates(isNewProject);

	  if (isNewProject) {
	    $( "#tabName" ).html("New Project Detail");
	    newProject();
	  }
});

</script>
</html>